<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mértékegység-váltás – 30 feladat (hossz, tömeg, űrtartalom, idő, terület, térfogat)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background:#f6f7fb; color:#111; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
    h1 { font-size: 20px; margin: 0 0 6px; }
    .sub { margin: 0 0 16px; color:#444; }
    .controls { display:flex; gap:14px; flex-wrap:wrap; align-items:center; margin: 12px 0 18px; }
    button{
      border:0; padding:10px 14px; border-radius:10px; cursor:pointer;
      background:#1f6feb; color:#fff; font-weight:900;
    }
    button.secondary{ background:#2b2f36; }
    button:disabled{ opacity:.55; cursor:not-allowed; }
    .score{
      font-weight:900; font-size:18px; background:#eef2ff; color:#243b8a;
      padding:8px 14px; border-radius:999px;
    }
    .filters{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      background:#fff; border-radius:14px; padding:10px 12px;
      border:1px solid rgba(0,0,0,.06); box-shadow:0 6px 18px rgba(0,0,0,.04);
    }
    .filters label{ font-size:13px; color:#333; display:flex; gap:6px; align-items:center; }
    select{
      padding:8px 10px; border-radius:10px; border:1px solid #cfd6e4;
      background:#fff;
    }
    .grid{ display:grid; gap:12px; }
    .card{
      background:#fff; border-radius:14px; padding:14px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      border: 1px solid rgba(0,0,0,.06);
    }
    .meta{ display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center; }
    .tag{ font-size:12px; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#243b8a; }
    .task{ margin:10px 0 12px; font-size:18px; line-height:1.25; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .answerRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input[type="text"]{
      padding:10px 12px; border-radius:10px; border:1px solid #cfd6e4;
      min-width:220px; font-size:16px;
    }
    input:disabled{ background:#f1f3f8; }
    .hint{ font-size:12px; color:#666; }
    .result{ margin-top:10px; font-size:14px; }
    .ok{ color:#0a7a2f; font-weight:900; }
    .bad{ color:#b00020; font-weight:900; }
    .small{ font-size:12px; color:#555; margin-top:4px; }
    .note{ font-size:13px; color:#555; margin-top: 10px; }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Mértékegység-váltás</h1>
    <p class="sub">
      30 feladat. Új feladatsor + Ellenőrzés. Ellenőrzés után nem szerkeszthető.
      (Válasz: csak a számot írd be, az egységet a feladat megadja.)
    </p>

    <div class="controls">
      <button id="checkBtn">Ellenőrzés</button>
      <button id="newBtn" class="secondary">Új feladatsor</button>
      <div id="score" class="score">0/30</div>

      <div class="filters" title="Opcionális: választhatsz témakört is.">
        <label>Feladattípus:
          <select id="mode">
            <option value="mix" selected>Vegyes</option>
            <option value="length">Hosszúság</option>
            <option value="area">Terület</option>
            <option value="volume">Térfogat</option>
            <option value="mass">Tömeg</option>
            <option value="capacity">Űrtartalom</option>
            <option value="time">Idő</option>
          </select>
        </label>
      </div>
    </div>

    <div id="tasks" class="grid"></div>

    <p class="note">
      Elfogadott beírás: <span class="mono">12,5</span> vagy <span class="mono">12.5</span>.
    </p>
  </div>

<script>
(() => {
  const tasksEl = document.getElementById("tasks");
  const checkBtn = document.getElementById("checkBtn");
  const newBtn = document.getElementById("newBtn");
  const scoreEl = document.getElementById("score");
  const modeSel = document.getElementById("mode");

  let problems = [];
  let locked = false;

  const rndInt = (a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const pick = arr => arr[Math.floor(Math.random()*arr.length)];

  function parseHu(str){
    if(!str) return NaN;
    return Number(String(str).trim().replace(/\s+/g,'').replace(',', '.'));
  }

  function hu(v){
    let s = Number(v).toFixed(6).replace(/\.?0+$/,'');
    return s.replace('.', ',');
  }

  function almostEqual(a,b){
    return Math.abs(a-b) <= 0.0005;
  }

  // ---- Átváltó táblák (alapegységre szorzók) ----
  // Hossz: alap = m
  const LENGTH = [
    { u:"mm", k:0.001 }, { u:"cm", k:0.01 }, { u:"dm", k:0.1 },
    { u:"m",  k:1 },     { u:"km", k:1000 }
  ];

  // Terület: alap = m²  (itt a váltószámok négyzetesek!)
  const AREA = [
    { u:"mm²", k:1e-6 },
    { u:"cm²", k:1e-4 },
    { u:"dm²", k:1e-2 },
    { u:"m²",  k:1 },
    { u:"a",   k:100 },        // are
    { u:"ha",  k:10000 },      // hektár
    { u:"km²", k:1e6 }
  ];

  // Térfogat: alap = m³ (köbös!)
  const VOLUME = [
    { u:"cm³", k:1e-6 },
    { u:"dm³", k:1e-3 },  // 1 dm³ = 1 liter
    { u:"m³",  k:1 }
  ];

  // Tömeg: alap = g
  const MASS = [
    { u:"mg", k:0.001 }, { u:"g", k:1 }, { u:"dkg", k:10 },
    { u:"kg", k:1000 }, { u:"t", k:1000000 }
  ];

  // Űrtartalom: alap = l
  const CAP = [
    { u:"ml", k:0.001 }, { u:"cl", k:0.01 }, { u:"dl", k:0.1 },
    { u:"l",  k:1 }
  ];

  // Idő: alap = s
  const TIME = [
    { u:"s", k:1 }, { u:"min", k:60 }, { u:"h", k:3600 }, { u:"nap", k:86400 }
  ];

  function makeConv(set, kind){
    const from = pick(set);
    let to = pick(set);
    while(to.u === from.u) to = pick(set);

    // "szép" célérték a TO egységben
    const targetIsInt = Math.random() < 0.75;
    const target = targetIsInt ? rndInt(1, 500) : (rndInt(1, 200) / 10);

    const base = target * to.k;       // alapegységben
    const valueFrom = base / from.k;  // from egységben
    const valueFromRounded = Math.round(valueFrom * 1000000) / 1000000;

    return {
      kind,
      fromU: from.u, toU: to.u,
      fromVal: valueFromRounded,
      ans: target,
      text: `${hu(valueFromRounded)} ${from.u} = ____ ${to.u}`
    };
  }

  function genProblems(mode){
    const wanted = 30;
    const makers = {
      length: () => makeConv(LENGTH, "Hosszúság"),
      area: () => makeConv(AREA, "Terület"),
      volume: () => makeConv(VOLUME, "Térfogat"),
      mass: () => makeConv(MASS, "Tömeg"),
      capacity: () => makeConv(CAP, "Űrtartalom"),
      time: () => makeConv(TIME, "Idő")
    };

    let list = [];
    if(mode === "mix"){
      const all = [makers.length, makers.area, makers.volume, makers.mass, makers.capacity, makers.time];
      for(let i=0;i<wanted;i++) list.push(pick(all)());
    } else {
      for(let i=0;i<wanted;i++) list.push(makers[mode]());
    }

    // Keverés
    for(let i=list.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [list[i], list[j]] = [list[j], list[i]];
    }
    return list;
  }

  function buildUI(){
    tasksEl.innerHTML = "";
    problems.forEach((p, i) => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="meta">
          <div class="tag">${i+1}. feladat • ${p.kind}</div>
          <div class="hint">Csak a számot írd be.</div>
        </div>
        <div class="task mono">${p.text}</div>
        <div class="answerRow">
          <label for="a${i}"><b>Válasz:</b></label>
          <input id="a${i}" type="text" placeholder="pl. 12,5" inputmode="decimal" ${locked ? "disabled" : ""}/>
          <span class="hint">${p.toU}</span>
        </div>
        <div id="r${i}" class="result"></div>
      `;
      tasksEl.appendChild(card);
    });
  }

  function newSet(){
    locked = false;
    checkBtn.disabled = false;
    scoreEl.textContent = "0/30";
    problems = genProblems(modeSel.value);
    buildUI();
  }

  function lockInputs(){
    locked = true;
    for(let i=0;i<problems.length;i++){
      const inp = document.getElementById(`a${i}`);
      if(inp) inp.disabled = true;
    }
    checkBtn.disabled = true;
  }

  function check(){
    let good = 0;

    problems.forEach((p, i) => {
      const inp = document.getElementById(`a${i}`);
      const out = document.getElementById(`r${i}`);
      const userVal = parseHu(inp.value);

      if(Number.isNaN(userVal)){
        out.innerHTML = `<span class="bad">Hiányzó vagy hibás szám.</span>
                         <div class="small">Példa: 12,5</div>`;
        return;
      }

      const ok = almostEqual(userVal, p.ans);
      if(ok){
        good++;
        out.innerHTML = `<span class="ok">Helyes!</span>
                         <div class="small">Eredmény: ${hu(p.ans)} ${p.toU}</div>`;
      } else {
        out.innerHTML = `<span class="bad">Nem jó.</span>
                         <div class="small">Helyes: <b>${hu(p.ans)} ${p.toU}</b></div>`;
      }
    });

    scoreEl.textContent = `${good}/30`;
    lockInputs();
  }

  checkBtn.addEventListener("click", check);
  newBtn.addEventListener("click", newSet);
  modeSel.addEventListener("change", newSet);

  newSet();
})();
</script>
</body>
</html>
